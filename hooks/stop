#!/bin/bash
set -e

CHARM_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
# shellcheck disable=SC1091
source "$CHARM_DIR/hooks/common.sh"

ROLE="$(get_unit_role)"
log_info "Stopping OpenClaw $ROLE"

status-set maintenance "Stopping OpenClaw $ROLE service"

if [ "$ROLE" = "gateway" ]; then
    stop_openclaw
    close_ports
else
    stop_openclaw_node
fi

status-set maintenance "OpenClaw $ROLE stopped"
log_info "OpenClaw $ROLE stopped successfully"
